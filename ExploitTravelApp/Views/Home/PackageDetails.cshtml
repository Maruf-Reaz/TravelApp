@model ExploitTravelApp.Models.ExploitPackages.ExploitPackage

@using Microsoft.AspNetCore.Identity
@inject SignInManager<ExploitTravelApp.Models.Common.Authentication.ApplicationUser> SignInManager
@inject UserManager<ExploitTravelApp.Models.Common.Authentication.ApplicationUser> UserManager

@{
    var userForBooking = new ExploitTravelApp.Models.Common.Authentication.ApplicationUser();
    if (SignInManager.IsSignedIn(User))
    {
        var user = await UserManager.FindByNameAsync(Context.User.Identity.Name);
        userForBooking = user;
        var userId = (await UserManager.FindByNameAsync(Context.User.Identity.Name)).Id;
    }
}


@{ViewData["Title"] = "Package details";}

@{ViewData["body-class"] = "product-page";}

@section Sole {
    <style>
        .header-filter[filter-color="rose"]::after {
            background: rgba(0,0,0,.5) !important;
        }

        ul.timeline {
            list-style-type: none;
            position: relative;
        }

            ul.timeline:before {
                content: ' ';
                background: #d4d9df;
                display: inline-block;
                position: absolute;
                left: 29px;
                width: 2px;
                height: 100%;
                z-index: 400;
            }

            ul.timeline > li {
                margin: 20px 0;
                padding-left: 20px;
            }

                ul.timeline > li .card:before {
                    left: -15px;
                    right: auto;
                    position: absolute;
                    top: 26px;
                    display: inline-block;
                    border-top: 15px solid transparent;
                    content: " ";
                    border-left-width: 0;
                    border-bottom: 15px solid transparent;
                    border-right: 15px solid #21C0D4;
                }

                ul.timeline > li:before {
                    content: ' ';
                    background: white;
                    display: inline-block;
                    position: absolute;
                    border-radius: 50%;
                    border: 3px solid #E91E63;
                    left: 20px;
                    width: 20px;
                    height: 20px;
                    z-index: 400;
                }
    </style>
}

<div class="page-header header-filter" data-parallax="true" filter-color="rose" style="background-image: url('/img/dg2.jpg');">
</div>
<div class="section">
    <div class="container">
        <div class="main main-raised main-product">
            <div class="row">
                <div class="col-md-6 col-sm-6">
                    <div class="tab-content">
                        <div class="tab-pane active" id="product-page1">
                            <img src="~/files/exploit_packages/@Model.PhotoName1">
                        </div>
                        <div class="tab-pane" id="product-page2">
                            <img src="~/files/exploit_packages/@Model.PhotoName2">
                        </div>
                        <div class="tab-pane" id="product-page3">
                            <img src="~/files/exploit_packages/@Model.PhotoName3">
                        </div>
                        <div class="tab-pane" id="product-page4">
                            <img src="~/files/exploit_packages/@Model.PhotoName4">
                        </div>
                        <div class="tab-pane" id="product-page5">
                            <img src="~/files/exploit_packages/@Model.PhotoName5">
                        </div>
                    </div>
                    <ul class="nav flexi-nav" data-tabs="tabs" id="flexiselDemo1">
                        <li class="nav-item">
                            <a href="#product-page1" class="nav-link" data-toggle="tab">
                                <img src="~/files/exploit_packages/@Model.PhotoName1">
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#product-page2" class="nav-link" data-toggle="tab">
                                <img src="~/files/exploit_packages/@Model.PhotoName2">
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#product-page3" class="nav-link" data-toggle="tab">
                                <img src="~/files/exploit_packages/@Model.PhotoName3">
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#product-page4" class="nav-link" data-toggle="tab">
                                <img src="~/files/exploit_packages/@Model.PhotoName4">
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#product-page5" class="nav-link" data-toggle="tab">
                                <img src="~/files/exploit_packages/@Model.PhotoName5">
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-6 col-sm-6">
                    <h2 class="title">@Model.Name</h2>
                    <div class="position-relative">
                        <h4 class="text-teal font-weight-bold mb-0">
                            TK @Model.DefaultPrice/-
                            @*<small class="price-off line-through mr-3">
                                    TK 26,495/-
                                </small>
                                <span class="badge badge-rose badge-pill price-off-percent">12% off</span>*@
                        </h4>
                        @{
                            bool hasDeluxBed = false;
                            foreach (var hotel in Model.Hotels)
                            {
                                @if (hotel.Room1HasDeluxBed || hotel.Room2HasDeluxBed || hotel.Room3HasDeluxBed)
                                {
                                    hasDeluxBed = true;
                                }
                            }
                            @if (hasDeluxBed)
                            {
                                <small class="text-muted">*Per Person on twin sharing</small>
                            }
                        }
                        <small class="text-muted d-block">*@Model.Days Days &amp; @Model.Nights Nights</small>
                    </div>
                    <div class="blog-tags">
                        <span class="badge badge-default badge-pill">@Model.Bundle.Name</span>
                        <span class="badge badge-default badge-pill">@Model.ExploitPackageCategory.Name</span>
                    </div>
                    <div id="accordion" role="tablist">
                        <div class="card card-collapse">
                            <div class="card-header" role="tab" id="headingOne">
                                <h5 class="mb-0">
                                    <a data-toggle="collapse" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                        Description
                                        <i class="material-icons">keyboard_arrow_down</i>
                                    </a>
                                </h5>
                            </div>
                            <div id="collapseOne" class="collapse show" role="tabpanel" aria-labelledby="headingOne" data-parent="#accordion">
                                <div class="card-body">
                                    <p>@Model.Note</p>
                                </div>
                            </div>
                        </div>
                        <div class="card card-collapse">
                            <div class="card-header" role="tab" id="headingTwo">
                                <h5 class="mb-0">
                                    <a class="collapsed" data-toggle="collapse" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                        Hotel Information
                                        <i class="material-icons">keyboard_arrow_down</i>
                                    </a>
                                </h5>
                            </div>
                            <div id="collapseTwo" class="collapse" role="tabpanel" aria-labelledby="headingTwo" data-parent="#accordion">
                                <div class="card-body">
                                    @foreach (var hotel in Model.Hotels)
                                    {
                                        <div class="hotel-information mb-4">
                                            <h3 class="card-title mb-0">Hotel : @hotel.NameAddressAndDescription</h3>
                                            <small class="small text-info">*Included with the package</small>
                                            <div class="room-informtion">
                                                <h4>Room 1</h4>
                                                <ul>
                                                    <li>Room Type : @hotel.Room1Type</li>
                                                    <li>Fixed Expense : @hotel.Room1FixedExpense</li>
                                                    <li>Variable Expense : @hotel.Room1VariableExpense</li>
                                                    <li>Capacity : @hotel.Room1Capacity</li>
                                                </ul>
                                                <div class="blog-tags mt-3">
                                                    @if (hotel.Room1HasBalcony)
                                                    {
                                                        <span class="badge badge-default badge-pill">Balcony</span>
                                                    }
                                                    @if (hotel.Room1HasWardrobe)
                                                    {
                                                        <span class="badge badge-default badge-pill">Wardrobe</span>
                                                    }
                                                    @if (hotel.Room1HasRoomService)
                                                    {
                                                        <span class="badge badge-default badge-pill">Room Service</span>
                                                    }
                                                    @if (hotel.Room1HasSittingChair)
                                                    {
                                                        <span class="badge badge-default badge-pill">Sitting Chair</span>
                                                    }
                                                    @if (hotel.Room1HasTV)
                                                    {
                                                        <span class="badge badge-default badge-pill">TV</span>
                                                    }
                                                    @if (hotel.Room1HasMarbleFloor)
                                                    {
                                                        <span class="badge badge-default badge-pill">Marble Floor</span>
                                                    }
                                                    @if (hotel.Room1HasTelephone)
                                                    {
                                                        <span class="badge badge-default badge-pill">Telephone</span>
                                                    }
                                                    @if (hotel.Room1HasDeluxBed)
                                                    {
                                                        <span class="badge badge-default badge-pill">Delux Bed</span>
                                                    }
                                                </div>
                                            </div>
                                            <div class="room-informtion">
                                                <h4>Room 2</h4>
                                                <ul>
                                                    <li>Room Type : @hotel.Room2Type</li>
                                                    <li>Fixed Expense : @hotel.Room2FixedExpense</li>
                                                    <li>Variable Expense : @hotel.Room2VariableExpense</li>
                                                    <li>Capacity : @hotel.Room2Capacity</li>
                                                </ul>
                                                <div class="blog-tags mt-3">
                                                    @if (hotel.Room2HasBalcony)
                                                    {
                                                        <span class="badge badge-default badge-pill">Balcony</span>
                                                    }
                                                    @if (hotel.Room2HasWardrobe)
                                                    {
                                                        <span class="badge badge-default badge-pill">Wardrobe</span>
                                                    }
                                                    @if (hotel.Room2HasRoomService)
                                                    {
                                                        <span class="badge badge-default badge-pill">Room Service</span>
                                                    }
                                                    @if (hotel.Room2HasSittingChair)
                                                    {
                                                        <span class="badge badge-default badge-pill">Sitting Chair</span>
                                                    }
                                                    @if (hotel.Room2HasTV)
                                                    {
                                                        <span class="badge badge-default badge-pill">TV</span>
                                                    }
                                                    @if (hotel.Room2HasMarbleFloor)
                                                    {
                                                        <span class="badge badge-default badge-pill">Marble Floor</span>
                                                    }
                                                    @if (hotel.Room2HasTelephone)
                                                    {
                                                        <span class="badge badge-default badge-pill">Telephone</span>
                                                    }
                                                    @if (hotel.Room2HasDeluxBed)
                                                    {
                                                        <span class="badge badge-default badge-pill">Delux Bed</span>
                                                    }
                                                </div>
                                            </div>
                                            <div class="room-informtion">
                                                <h4>Room 3</h4>
                                                <ul>
                                                    <li>Room Type : @hotel.Room3Type</li>
                                                    <li>Fixed Expense : @hotel.Room3FixedExpense</li>
                                                    <li>Variable Expense : @hotel.Room3VariableExpense</li>
                                                    <li>Capacity : @hotel.Room3Capacity</li>
                                                </ul>
                                                <div class="blog-tags mt-3">
                                                    @if (hotel.Room3HasBalcony)
                                                    {
                                                        <span class="badge badge-default badge-pill">Balcony</span>
                                                    }
                                                    @if (hotel.Room3HasWardrobe)
                                                    {
                                                        <span class="badge badge-default badge-pill">Wardrobe</span>
                                                    }
                                                    @if (hotel.Room3HasRoomService)
                                                    {
                                                        <span class="badge badge-default badge-pill">Room Service</span>
                                                    }
                                                    @if (hotel.Room3HasSittingChair)
                                                    {
                                                        <span class="badge badge-default badge-pill">Sitting Chair</span>
                                                    }
                                                    @if (hotel.Room3HasTV)
                                                    {
                                                        <span class="badge badge-default badge-pill">TV</span>
                                                    }
                                                    @if (hotel.Room3HasMarbleFloor)
                                                    {
                                                        <span class="badge badge-default badge-pill">Marble Floor</span>
                                                    }
                                                    @if (hotel.Room3HasTelephone)
                                                    {
                                                        <span class="badge badge-default badge-pill">Telephone</span>
                                                    }
                                                    @if (hotel.Room3HasDeluxBed)
                                                    {
                                                        <span class="badge badge-default badge-pill">Delux Bed</span>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="card card-collapse">
                            <div class="card-header" role="tab" id="headingThree">
                                <h5 class="mb-0">
                                    <a class="collapsed" data-toggle="collapse" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                        Sight Description
                                        <i class="material-icons">keyboard_arrow_down</i>
                                    </a>
                                </h5>
                            </div>
                            <div id="collapseThree" class="collapse" role="tabpanel" aria-labelledby="headingThree" data-parent="#accordion">
                                <div class="card-body">
                                    @foreach (var sight in Model.Sights)
                                    {
                                        <div class="sight-information">
                                            <h4 class="mb-0">@sight.Name</h4>
                                            @if (sight.IsIncluded)
                                            {
                                                <small class="small text-info">*Included with the package</small>
                                            }
                                            else
                                            {
                                                <small class="small text-danger">* Not included with the package price</small>
                                            }
                                            <ul>
                                                <li>Fixed Expense : @sight.FixedExpense</li>
                                                <li>Variable Expense : @sight.VariableExpense</li>
                                                <li>Capacity : @sight.Capacity</li>
                                            </ul>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="card card-collapse">
                            <div class="card-header" role="tab" id="headingFour">
                                <h5 class="mb-0">
                                    <a class="collapsed" data-toggle="collapse" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                        Activity Description
                                        <i class="material-icons">keyboard_arrow_down</i>
                                    </a>
                                </h5>
                            </div>
                            <div id="collapseFour" class="collapse" role="tabpanel" aria-labelledby="headingFour" data-parent="#accordion">
                                <div class="card-body">
                                    @foreach (var activity in Model.Activities)
                                    {
                                        <div class="activity-information">
                                            <h4 class="mb-0">@activity.Name</h4>
                                            @if (activity.IsIncluded)
                                            {
                                                <small class="small text-info">*Included with the package</small>
                                            }
                                            else
                                            {
                                                <small class="small text-danger">* Not included with the package price</small>
                                            }
                                            <ul>
                                                <li>Fixed Expense : @activity.FixedExpense</li>
                                                <li>Variable Expense : @activity.VariableExpense</li>
                                                <li>Capacity : @activity.Capacity</li>
                                            </ul>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="card card-collapse">
                            <div class="card-header" role="tab" id="headingFive">
                                <h5 class="mb-0">
                                    <a class="collapsed" data-toggle="collapse" href="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                        Travel Itinerary
                                        <i class="material-icons">keyboard_arrow_down</i>
                                    </a>
                                </h5>
                            </div>
                            <div id="collapseFive" class="collapse" role="tabpanel" aria-labelledby="headingive" data-parent="#accordion">
                                <div class="card-body">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-md-6 px-0">
                                                <ul class="timeline">
                                                    @foreach (var travelItinerary in Model.TravelItineraries)
                                                    {
                                                        <li>
                                                            <div class="card bg-info p-4" style="width: 375px">
                                                                <div class="blog-tags">
                                                                    <span class="badge badge-light text-dark badge-pill">@travelItinerary.Activity</span>
                                                                </div>
                                                                <div class="card-body">
                                                                    <ul>
                                                                        <li>Departure From : @travelItinerary.DepartureFrom</li>
                                                                        <li>Arrival At : @travelItinerary.ArrivalAt</li>
                                                                        <li>Transfer Type : @travelItinerary.TransferType</li>
                                                                        <li>Check In At : @travelItinerary.CheckInAt</li>
                                                                        <li>Meal Description : @travelItinerary.MealDescription</li>
                                                                        <li>Sight Seeing : @travelItinerary.SightSeeing</li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    }
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    @if (SignInManager.IsSignedIn(User))
                    {
                        @if (await UserManager.IsInRoleAsync(userForBooking, "Visitor"))
                        {
                            <div class="row pull-right mt-5">
                                <a asp-action="Create" asp-controller="Bookings" asp-route-visitorId="@userForBooking.Id" asp-route-packageId="@Model.Id" class="btn btn-rose btn-round">Customize & Book &#xA0;<i class="fa fa-plane ml-2"></i></a>
                            </div>
                        }
                    }
                    else
                    {
                        <h6 class="text-danger mt-5">
                            <i class="fa fa-exclamation-triangle mr-2"></i> Visitors must <a asp-controller="Account" asp-action="Login">Sign In</a> in order to book a package.
                        </h6>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/plugins/jquery.flexisel.js" type="text/javascript"></script>
    <script>
        $(document).ready(function () {
            $("#flexiselDemo1").flexisel({
                visibleItems: 4,
                itemsToScroll: 1,
                animationSpeed: 400,
                enableResponsiveBreakpoints: true,
                responsiveBreakpoints: {
                    portrait: {
                        changePoint: 480,
                        visibleItems: 3
                    },
                    landscape: {
                        changePoint: 640,
                        visibleItems: 3
                    },
                    tablet: {
                        changePoint: 768,
                        visibleItems: 3
                    }
                }
            });
        });
    </script>
}