@using Microsoft.AspNetCore.Identity
@inject UserManager<ExploitTravelApp.Models.Common.Authentication.ApplicationUser> UserManager
@{
    var user = await UserManager.FindByNameAsync(Context.User.Identity.Name);
    var userId = (await UserManager.FindByNameAsync(Context.User.Identity.Name)).Id;
    var userName = (await UserManager.FindByNameAsync(Context.User.Identity.Name)).UserName;
}

<nav class="navbar fixed-top navbar-expand-lg" color-on-scroll="200" id="sectionsNav">
    <div class="container">
        <div class="navbar-translate">
            <a class="navbar-brand" asp-controller="Home" asp-action="Backpanel">
                <img src="~/img/favicon/index.png" class="d-inline-block align-top mr-2" alt="Logo" width="30" />
                Exploit
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="sr-only">Toggle navigation</span>
                <span class="navbar-toggler-icon"></span>
                <span class="navbar-toggler-icon"></span>
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item dropdown mega-dropdown position-static">
                    <a href="#" class="nav-link dropdown-toggle text-uppercase" id="navbarDropdownMenuLink2" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">
                        <i class="far fa-th mr-2"></i> Menu
                        <span class="sr-only">(current)</span>
                    </a>
                    <div class="dropdown-menu mega-menu v-2 z-depth-1 special-color py-5 px-3 w-100"
                         aria-labelledby="navbarDropdownMenuLink2">
                        <div class="row">
                            @if (await UserManager.IsInRoleAsync(user, "Admin"))
                            {
                                <div class="col-md-6 col-xl-3 sub-menu mb-xl-0 mb-4">
                                    <h6 class="sub-title text-uppercase font-weight-bold white-text">Featured</h6>
                                    <ul class="list-unstyled">
                                        <li>
                                            <a class="menu-item pl-3" asp-action="GetDivisions" asp-controller="Locations">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Divisions
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="Locations">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Locations
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="Bundles">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Group
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="ExploitPackageCategories">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Tour Themes
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="Videos">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Videos
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-6 col-xl-3 sub-menu mb-xl-0 mb-4">
                                    <h6 class="sub-title text-uppercase font-weight-bold white-text">Users</h6>
                                    <ul class="list-unstyled">
                                        <li>
                                            <a class="menu-item pl-3" asp-action="GetAdmins" asp-controller="Users">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Admins
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="GetPendingAgents" asp-controller="Users">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Pending Agents
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="GetApprovedAgents" asp-controller="Users">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Approved Agents
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="Users">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Visitors
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="Roles">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Roles
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-6 col-xl-3 sub-menu mb-0">
                                    <h6 class="sub-title text-uppercase font-weight-bold white-text">Admin Panel</h6>
                                    <ul class="list-unstyled">
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="Bookings">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Bookings
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="GetPendingPackages" asp-controller="ExploitPackages">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Pending Packages
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="GetApprovedPackages" asp-controller="ExploitPackages">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Approved Packages
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="Blogs">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Blogs
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="Quotes">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Quotes
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            }
                            @if (await UserManager.IsInRoleAsync(user, "Agent"))
                            {
                                <div class="col-md-6 col-xl-3 sub-menu mb-xl-0 mb-4">
                                    <h6 class="sub-title text-uppercase font-weight-bold white-text">Featured</h6>
                                    <ul class="list-unstyled">
                                        <li>
                                            <a class="menu-item pl-3" asp-action="GetDivisions" asp-controller="Locations">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Divisions
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="Locations">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Locations
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="Bundles">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Bundles
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="ExploitPackageCategories">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>Tour Themes
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-6 col-xl-3 sub-menu mb-md-0 mb-xl-0 mb-4">
                                    <h6 class="sub-title text-uppercase font-weight-bold white-text">Agent Panel</h6>
                                    <ul class="list-unstyled">
                                        <li>
                                            <a class="menu-item pl-3" asp-action="Index" asp-controller="ExploitPackages" asp-route-agentId="@userId">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>My Packages
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="GetBookingsOfAgent" asp-controller="Bookings" asp-route-agentId="@userId">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>My Bookings
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            }
                            @if (await UserManager.IsInRoleAsync(user, "Visitor"))
                            {
                                <div class="col-md-6 col-xl-3 sub-menu mb-0">
                                    <h6 class="sub-title text-uppercase font-weight-bold white-text">Visitor Panel</h6>
                                    <ul class="list-unstyled">
                                        <li>
                                            <a class="menu-item pl-3" asp-action="GetBookingsOfVisitor" asp-controller="Bookings" asp-route-visitorId="@userId">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>My Bookings
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="GetBlogsOfVisitor" asp-controller="Blogs" asp-route-visitorId="@userId">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>My Blogs
                                            </a>
                                        </li>
                                        <li>
                                            <a class="menu-item pl-3" asp-action="GetQuotesOfVisitor" asp-controller="Quotes" asp-route-visitorId="@userId">
                                                <i class="fa fa-caret-right pl-1 pr-3"></i>My Quotes
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            }
                        </div>
                    </div>
                </li>

                <li class="nav-item">
                    <a asp-controller="Home" asp-action="Index" class="nav-link">
                        <i class="far fa-home mr-2"></i> Home
                    </a>
                </li>

                <li class="dropdown nav-item">
                    <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                        <i class="far fa-user mr-2"></i> @userName
                    </a>
                    <div class="dropdown-menu dropdown-with-icons">
                        @if (await UserManager.IsInRoleAsync(user, "Agent"))
                        {
                            <a asp-controller="Users" asp-action="UpdateProfileOfAgent" asp-route-userId="@userId" class="dropdown-item">
                                <i class="far fa-user mr-2 d-none d-lg-block"></i> Update Profile
                            </a>
                        }
                        @if (await UserManager.IsInRoleAsync(user, "Visitor"))
                        {
                            <a asp-controller="Users" asp-action="UpdateProfileOfVisitor" asp-route-userId="@userId" class="dropdown-item">
                                <i class="far fa-user mr-2 d-none d-lg-block"></i> Update Profile
                            </a>
                        }
                        <a asp-action="UpdatePassword" asp-controller="Account" asp-route-userId="@userId" class="dropdown-item">
                            <i class="far fa-key mr-2 d-none d-lg-block"></i>  Change Password
                        </a>
                    </div>
                </li>

                <li class="button-container nav-item iframe-extern">
                    <form asp-action="Logout" id="logoutForm" asp-controller="Account" method="post">
                        <a href="javascript:document.getElementById('logoutForm').submit()" class="btn btn-rose btn-round btn-block logout-confirm">
                            <i class="far fa-sign-out mr-2"></i>Logout
                        </a>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>